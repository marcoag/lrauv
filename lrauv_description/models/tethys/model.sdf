<?xml version="1.0"?>
<!--
  Development of this module has been funded by the Monterey Bay Aquarium
  Research Institute (MBARI) and the David and Lucile Packard Foundation
-->
<sdf version="1.6">
  <model name="tethys">
    <!-- Pressure hull -->
    <link name="base_link">
      <pose>0.457 0 0.003 0 0 0</pose>
      <inertial>
        <mass>44.6</mass>
        <inertia>
          <ixx>0.708</ixx>
          <ixy>0.004</ixy>
          <ixz>0.019</ixz>
          <iyy>8.262</iyy>
          <iyz>-0.001</iyz>
          <izz>8.237</izz>
        </inertia>
      </inertial>

      <collision name="main_body_buoyancy">
        <pose>0 0 0.007 0 0 0</pose>
        <geometry>
          <box>
            <!--<size>2 0.3 0.074333</size>-->
            <size>2 0.3 0.127217833333</size>
          </box>
        </geometry>
      </collision>

      <visual name="visual">
        <pose>-0.457 0 -0.003 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>meshes/tethys.dae</uri>
            <submesh>
              <name>Body</name>
              <center>false</center>
            </submesh>
          </mesh>
        </geometry>
        <material>
          <diffuse>1.0 1.0 1.0 1.0</diffuse>
          <specular>1.0 1.0 1.0 1.0</specular>
          <pbr>
            <metal>
              <albedo_map>materials/textures/Tethys_Albedo.png</albedo_map>
              <normal_map>materials/textures/Tethys_Normal.png</normal_map>
              <metalness_map>materials/textures/Tethys_Metalness.png</metalness_map>
              <roughness_map>materials/textures/Tethys_Roughness.png</roughness_map>
            </metal>
          </pbr>
          <script>
            <uri>materials/scripts/</uri>
            <uri>materials/textures/</uri>
            <name>tethys/Tethys_Diffuse</name>
          </script>
        </material>
      </visual>
    </link>

    <!-- Tailcone -->
    <link name="tailcone_link">
      <pose>-0.277 0 0.004 0 0 0</pose>
      <inertial>
        <mass>15.35</mass>
        <inertia>
          <ixx>0.21</ixx>
          <ixy>0</ixy>
          <ixz>0.012</ixz>
          <iyy>0.853</iyy>
          <iyz>0.001</iyz>
          <izz>0.767</izz>
        </inertia>
      </inertial>

      <collision name="tail_cone_buoyancy">
        <geometry>
          <box>
            <size>2 0.3 0.02725</size>
          </box>
        </geometry>
      </collision>

      <visual name="visual">
        <pose>0.277 0 -0.004 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>meshes/tethys.dae</uri>
            <submesh>
              <name>Tails</name>
              <center>false</center>
            </submesh>
          </mesh>
        </geometry>
        <material>
          <diffuse>1.0 1.0 1.0</diffuse>
          <specular>1.0 1.0 1.0</specular>
          <pbr>
            <metal>
              <albedo_map>materials/textures/Tethys_Albedo.png</albedo_map>
              <normal_map>materials/textures/Tethys_Normal.png</normal_map>
              <metalness_map>materials/textures/Tethys_Metalness.png</metalness_map>
              <roughness_map>materials/textures/Tethys_Roughness.png</roughness_map>
            </metal>
          </pbr>
          <script>
            <uri>materials/scripts/</uri>
            <uri>materials/textures/</uri>
            <name>tethys/Tethys_Diffuse</name>
          </script>
        </material>
      </visual>
    </link>

    <!-- Nose (short version) -->
    <link name="nose_link">
      <pose>1.126 0.003 0.004 0 0 0</pose>
      <inertial>
        <mass>16.77</mass>
        <inertia>
          <ixx>0.239</ixx>
          <ixy>0.003</ixy>
          <ixz>0.002</ixz>
          <iyy>0.537</iyy>
          <iyz>0.002</iyz>
          <izz>0.516</izz>
        </inertia>
      </inertial>

      <collision name="main_body_buoyancy">
        <geometry>
          <box>
            <size>2 0.3 0.02795</size>
          </box>
        </geometry>
      </collision>

      <visual name="visual">
        <pose>-1.126 -0.003 -0.004 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>meshes/tethys.dae</uri>
            <submesh>
              <name>Nose</name>
              <center>false</center>
            </submesh>
          </mesh>
        </geometry>
        <material>
          <diffuse>1.0 1.0 1.0</diffuse>
          <specular>1.0 1.0 1.0</specular>
          <pbr>
            <metal>
              <albedo_map>materials/textures/Tethys_Albedo.png</albedo_map>
              <normal_map>materials/textures/Tethys_Normal.png</normal_map>
              <metalness_map>materials/textures/Tethys_Metalness.png</metalness_map>
              <roughness_map>materials/textures/Tethys_Roughness.png</roughness_map>
            </metal>
          </pbr>
          <script>
            <uri>materials/scripts/</uri>
            <uri>materials/textures/</uri>
            <name>tethys/Tethys_Diffuse</name>
          </script>
        </material>
      </visual>
    </link>

    <!-- Horizontal fins -->
    <link name="horizontal_fins">
      <!--
        Actually -1.05 from origin, but since this is attached to the tailcone,
        then we need to transform it to the tailcone's origin.
      -->
      <pose>-0.773 0 0 0 0 0</pose>
      <inertial>
        <pose>0 0 0 1.57 0 0.5</pose>
        <mass>0.2</mass>
        <inertia>
          <ixx>0.0007924568755</ixx>
          <ixy>-0.0000000002674</ixy>
          <ixz>0.0003978158176</ixz>
          <iyy>0.0010546736475</iyy>
          <iyz>-0.0000000006729</iyz>
          <izz>0.0002633558262</izz>
        </inertia>
      </inertial>

      <collision name="collision">
        <geometry>
          <box>
            <size>0.1 0.1 0.02</size>
          </box>
        </geometry>
      </collision>

      <visual name="visual">
        <pose>0.773 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>meshes/tethys.dae</uri>
            <submesh>
              <name>Fins_Horizontal</name>
              <center>false</center>
            </submesh>
          </mesh>
        </geometry>
        <material>
          <diffuse>1.0 1.0 1.0</diffuse>
          <specular>1.0 1.0 1.0</specular>
          <pbr>
            <metal>
              <albedo_map>materials/textures/Tethys_Albedo.png</albedo_map>
              <normal_map>materials/textures/Tethys_Normal.png</normal_map>
              <metalness_map>materials/textures/Tethys_Metalness.png</metalness_map>
              <roughness_map>materials/textures/Tethys_Roughness.png</roughness_map>
            </metal>
          </pbr>
          <script>
            <uri>materials/scripts/</uri>
            <uri>materials/textures/</uri>
            <name>tethys/Tethys_Diffuse</name>
          </script>
        </material>
      </visual>
    </link>

    <!-- Vertical fins -->
    <link name="vertical_fins">
      <!--
        Actually -1.05 from origin, but since this is attached to the tailcone,
        then we need to transform it to the tailcone's origin.
      -->
      <pose>-0.773 0 0 0 0 0</pose>
      <inertial>
        <mass>0.2</mass>
        <inertia>
          <ixx>0.0007924568755</ixx>
          <ixy>-0.0000000002674</ixy>
          <ixz>0.0003978158176</ixz>
          <iyy>0.0010546736475</iyy>
          <iyz>-0.0000000006729</iyz>
          <izz>0.0002633558262</izz>
        </inertia>
      </inertial>

      <collision name="collision">
         <geometry>
          <box>
            <size>0.1 0.1 0.02</size>
          </box>
        </geometry>
      </collision>

      <visual name="visual">
        <pose>0.773 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>meshes/tethys.dae</uri>
            <submesh>
              <name>Fins_vertical</name>
              <center>false</center>
            </submesh>
          </mesh>
        </geometry>
        <material>
          <diffuse>1.0 1.0 1.0</diffuse>
          <specular>1.0 1.0 1.0</specular>
          <pbr>
            <metal>
              <albedo_map>materials/textures/Tethys_Albedo.png</albedo_map>
              <normal_map>materials/textures/Tethys_Normal.png</normal_map>
              <metalness_map>materials/textures/Tethys_Metalness.png</metalness_map>
              <roughness_map>materials/textures/Tethys_Roughness.png</roughness_map>
            </metal>
          </pbr>
          <script>
            <uri>materials/scripts/</uri>
            <uri>materials/textures/</uri>
            <name>tethys/Tethys_Diffuse</name>
          </script>
        </material>
      </visual>
    </link>

    <!-- Propeller -->
    <link name="propeller">
      <pose>1.43162 0 0 0 0 0</pose>
      <inertial>
        <pose>0 0 0 1.570796 0 0</pose>
        <mass>0.09</mass>
        <inertia>
          <ixx>0.000143971303</ixx>
          <ixy>0.000000000008</ixy>
          <ixz>-0.000000000224</ixz>
          <iyy>0.000140915448</iyy>
          <iyz>-0.000025236433</iyz>
          <izz>0.000033571862</izz>
        </inertia>
      </inertial>

      <collision name="collision">
        <geometry>
          <box>
            <size>0.03 0.1 0.03</size>
          </box>
        </geometry>
      </collision>

      <visual name="visual">
        <pose>-1.43162 0 0 0 0 0</pose>
        <geometry>
          <mesh>
            <uri>meshes/tethys.dae</uri>
            <submesh>
              <name>Prop</name>
              <center>false</center>
            </submesh>
          </mesh>
        </geometry>
        <material>
          <diffuse>1.0 1.0 1.0</diffuse>
          <specular>1.0 1.0 1.0</specular>
          <pbr>
            <metal>
              <albedo_map>materials/textures/Tethys_Albedo.png</albedo_map>
              <normal_map>materials/textures/Tethys_Normal.png</normal_map>
              <metalness_map>materials/textures/Tethys_Metalness.png</metalness_map>
              <roughness_map>materials/textures/Tethys_Roughness.png</roughness_map>
            </metal>
          </pbr>
          <script>
            <uri>materials/scripts/</uri>
            <uri>materials/textures/</uri>
            <name>tethys/Tethys_Diffuse</name>
          </script>
        </material>
      </visual>
    </link>

    <!-- Battery -->
    <!-- No separate collision for battery, because it is inside the vehicle.
         Additional collision requires buoyancy volume recalculation. -->
    <link name="battery">
      <!-- Technicaly should be: <pose>0.563 0 0.024 0 0 0</pose> but this
      introduces unwanted pitching. Currently we just pretend the battery is
      at the C.o.M of the vehicle. Alternatively, we could shave of some mass
      from the mainbody and simulate a counter weight... -->
      <pose>0.457 0 0.003 0 0 0</pose>
      <inertial>
        <!-- Non-zero y creates roll. Not fun to tune without actual base link inertia minus battery-->
        <mass>31.7307</mass>
        <inertia>
          <ixx>0.2327</ixx>
          <ixy>0</ixy>
          <ixz>-0.0004</ixz>
          <iyy>1.0930</iyy>
          <iyz>0</iyz>
          <izz>1.0344</izz>
        </inertia>
      </inertial>

      <visual name="visual">
        <geometry>
          <box>
            <!-- z is guesstimated from schematics. Visual doesn't matter. -->
            <size>0.6489446 0.24638 0.17415</size>
          </box>
        </geometry>
        <material>
          <diffuse>0.0 0.0 1.0 1.0</diffuse>
          <specular>0.0 0.0 1.0 1.0</specular>
        </material>
      </visual>
    </link>

    <link name="buoyancy_engine">
      <pose>-0.137 0 -0.045 0 0 0</pose>
      <inertial>
        <!-- Ignition requires a mass assigned to the link otherwise weird
        and wonderful segfaults may happen. So we create a neutral buoyancy link
        and then use the plugin to emulate the weight-->
        <mass>0.3</mass>
        <inertia>
          <ixx>0.000143971303</ixx>
          <ixy>0.000000000008</ixy>
          <ixz>-0.000000000224</ixz>
          <iyy>0.000140915448</iyy>
          <iyz>-0.000025236433</iyz>
          <izz>0.000033571862</izz>
        </inertia>
      </inertial>
      <collision name="collision">
        <geometry>
          <box>
            <size>0.03 0.1 0.1</size>
          </box>
        </geometry>
      </collision>
    </link>

    <!-- Joints -->
    <joint name="base_nose_joint" type="fixed">
      <parent>base_link</parent>
      <child>nose_link</child>
    </joint>

    <joint name="base_tailcone_joint" type="fixed">
      <parent>base_link</parent>
      <child>tailcone_link</child>
    </joint>

    <joint name="buoyancy_engine_joint" type="fixed">
      <pose>0 0 0 0 0 0</pose>
      <parent>base_link</parent>
      <child>buoyancy_engine</child>
      <namespace>tethys</namespace>
    </joint>

    <joint name="horizontal_fins_joint" type="revolute">
      <pose>0 0 0 0 0 0</pose>
      <parent>tailcone_link</parent>
      <child>horizontal_fins</child>
      <axis>
        <xyz>0 1 0</xyz>
        <limit>
          <lower>-0.261799</lower>
          <upper>0.261799</upper>
          <effort>-1</effort>
          <velocity>-1</velocity>
        </limit>
      </axis>
    </joint>

    <joint name="vertical_fins_joint" type="revolute">
      <pose>0 0 0 0 0 0</pose>
      <parent>tailcone_link</parent>
      <child>vertical_fins</child>
      <axis>
        <xyz>0 0 1</xyz>
        <limit>
          <lower>-0.261799</lower>
          <upper>0.261799</upper>
          <effort>-1</effort>
          <velocity>-1</velocity>
        </limit>
      </axis>
    </joint>

    <joint name="propeller_joint" type="revolute">
      <pose>0 0 0 0 0 0</pose>
      <parent>base_link</parent>
      <child>propeller</child>
      <axis>
        <xyz>1 0 0</xyz>
        <limit>
          <lower>-1e+12</lower>
          <upper>1e+12</upper>
          <effort>1e6</effort>
          <velocity>-1</velocity>
        </limit>
      </axis>
    </joint>

    <!-- positive joint values move mass forward -->
    <joint name="battery_joint" type="prismatic">
      <pose degrees="true">0 0 0   0 0 180</pose>
      <parent>base_link</parent>
      <child>battery</child>
      <axis>
        <xyz>1 0 0</xyz>
        <limit>
          <lower>-0.03</lower>
          <upper>0.03</upper>
          <effort>1e6</effort>
          <velocity>0.0007</velocity>
        </limit>
      </axis>
    </joint>

    <!-- Drop weight -->
    <link name="drop_weight">
      <!-- Hackjob: use tail pose otherwise we get exciting dynamics -->
      <pose>-0.277 0 0.004 0 0 0</pose>
      <inertial>
        <mass>1</mass>
        <inertia>
          <ixx>0.000143971303</ixx>
          <ixy>0.000000000008</ixy>
          <ixz>-0.000000000224</ixz>
          <iyy>0.000140915448</iyy>
          <iyz>-0.000025236433</iyz>
          <izz>0.000033571862</izz>
        </inertia>
      </inertial>
    </link>

  </model>
</sdf>
